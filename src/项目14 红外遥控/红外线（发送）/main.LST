C51 COMPILER V9.00   MAIN                                                                  07/06/2015 03:34:41 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /**********************BST-V51实验开发板例程************************
   2          *  平台：BST-M51 + Keil U4 + STC89C52
   3          *  名称：红外发送模块实验
   4          *  公司：深圳市亚博软件开发有限公司      
   5          *  日期：2015-6
   6          *  晶振:11.0592MHZ
   7          *  说明：免费开源，不提供源代码分析.
   8          ******************************************************************/
   9          #include <reg52.h>
  10          
  11          #define uchar unsigned char
  12          #define uint unsigned int 
  13          
  14          sbit k1 = P3^4;//定义四个独立按键
  15          sbit k2 = P3^5;
  16          sbit k3 = P3^6;
  17          sbit k4 = P3^7;
  18          sbit out=P1^5;//发送IO口
  19          
  20          const uchar TabHL1[12]={0x30,0x18,0x7a,0x10,0x38,0x5a,0x42,0x4a,
  21                                                          0x52,0x00,0xff,0xa6};//数据码码表1-9&2字节用户码
  22          /*------------------------------------------------
  23                            延时函数
  24          ------------------------------------------------*/
  25          void delay(uint xms)                            
  26          {
  27   1              uint i,j;
  28   1              for(i=xms;i>0;i--)                    //i=xms即延时约xms毫秒
  29   1                      for(j=112;j>0;j--);
  30   1      }
  31          
  32          void delay560us(void)   //560us延迟函数                 
  33          {
  34   1              uint j;
  35   1              for(j=63;j>0;j--);
  36   1      }
  37          
  38          void delay4500us(void)     //4.5ms延迟函数      
  39          {
  40   1              uint j;
  41   1              for(j=516;j>0;j--);
  42   1      }
  43          
  44          void khz_2(uint num)             //38KHZ脉冲 占空比1:2
  45          {
  46   1          for(;num>0;num--)
  47   1               {
  48   2      //        _nop_();
  49   2                out=~out;         
  50   2               }
  51   1      } 
  52          
  53          /*------------------------------------------------
  54                            发送逻辑0
  55          ------------------------------------------------*/
C51 COMPILER V9.00   MAIN                                                                  07/06/2015 03:34:41 PAGE 2   

  56          void send0(void)
  57          {  
  58   1         khz_2(42) ;
  59   1         //khz_3(21) ;
  60   1         out=1;
  61   1         delay560us();
  62   1      }
  63          /*------------------------------------------------
  64                            发送逻辑1
  65          ------------------------------------------------*/
  66          void send1(void)
  67          {  
  68   1         khz_2(42) ;
  69   1         //khz_3(21) ;
  70   1         out=1;
  71   1         delay560us();
  72   1         delay560us();
  73   1         delay560us();
  74   1      }
  75          /*------------------------------------------------
  76                          发送一字节数据
  77          ------------------------------------------------*/
  78          void Send8Bit(uchar dat)
  79          {
  80   1          if(dat&0x80){       send1();}
  81   1              else{           send0();}
  82   1              if(dat&0x40){   send1();}
  83   1              else{           send0();}
  84   1              if(dat&0x20){   send1();}
  85   1              else{           send0();}
  86   1              if(dat&0x10){   send1();}
  87   1              else{           send0();}
  88   1              if(dat&0x08){   send1();}
  89   1              else{           send0();}
  90   1              if(dat&0x04){   send1();}
  91   1              else{           send0();}
  92   1              if(dat&0x02){   send1();}
  93   1              else{           send0();}
  94   1              if(dat&0x01){   send1();}
  95   1              else{           send0();}
  96   1      
  97   1      }
  98          
  99          /*------------------------------------------------
 100                           发送用户码
 101          ------------------------------------------------*/
 102          void usercode()   //发送用户码 00FF
 103          {
 104   1           Send8Bit(TabHL1[9]);
 105   1               Send8Bit(TabHL1[10]);
 106   1      }
 107          /*------------------------------------------------
 108                           发送引导码
 109          ------------------------------------------------*/
 110          void leadcode(void)     //发送引导码
 111          {
 112   1           khz_2(690) ;
 113   1               //khz_3(345) ;
 114   1               out=1;
 115   1               delay4500us();
 116   1      
 117   1      }
C51 COMPILER V9.00   MAIN                                                                  07/06/2015 03:34:41 PAGE 3   

 118          /*------------------------------------------------
 119                           发送红外值
 120          ------------------------------------------------*/
 121          void send_1()   //00110000              发送”1“的信号
 122           {
 123   1           leadcode();
 124   1           usercode();
 125   1           Send8Bit(TabHL1[0]);
 126   1               Send8Bit(~TabHL1[0]);
 127   1       }
 128          
 129           void send_2()  //00011000         发送”2“的信号
 130           {
 131   1           leadcode();
 132   1           usercode();
 133   1               Send8Bit(TabHL1[1]);
 134   1               Send8Bit(TabHL1[1]);
 135   1       }
 136          
 137           void send_3()  //01111010         发送”3“的信号
 138           {
 139   1           leadcode();
 140   1           usercode();
 141   1               Send8Bit(TabHL1[2]);
 142   1               Send8Bit(TabHL1[2]);
 143   1       }
 144          
 145           void send_4()  //00010000        发送”4“的信号
 146           {
 147   1           leadcode();
 148   1           usercode();
 149   1               Send8Bit(TabHL1[3]);
 150   1               Send8Bit(TabHL1[3]);
 151   1       }
 152          
 153          /*------------------------------------------------
 154                           按键扫描函数
 155          ------------------------------------------------*/
 156          void keyscan()
 157          {
 158   1              while(1)
 159   1              {
 160   2                      if(k1 == 0)//判断是否有按下按键的信号
 161   2                      {
 162   3                              delay(10);//延时10ms 消抖
 163   3                              if(k1 == 0)//再次判断按键是否被按下
 164   3                              {
 165   4                                      while(k1 == 0);//直到按键判断松开
 166   4                                      send_1();//松开后执行程序 发送”1“的信号
 167   4                              }
 168   3                      }
 169   2                      if(k2 == 0)//判断是否有按下按键的信号
 170   2                      {
 171   3                              delay(10);//延时10ms 消抖
 172   3                              if(k2 == 0)//再次判断按键是否被按下
 173   3                              {
 174   4                                      while(k2 == 0);//直到按键判断松开
 175   4                                      send_2();//松开后执行程序 发送”2“的信号
 176   4                              }
 177   3                      }
 178   2                      if(k3 == 0)//判断是否有按下按键的信号
 179   2                      {
C51 COMPILER V9.00   MAIN                                                                  07/06/2015 03:34:41 PAGE 4   

 180   3                              delay(10);//延时10ms 消抖
 181   3                              if(k3 == 0)//再次判断按键是否被按下
 182   3                              {
 183   4                                      while(k3 == 0);//直到按键判断松开
 184   4                                      send_3();//松开后执行程序 发送”3“的信号
 185   4                              }
 186   3                      }
 187   2                      if(k4 == 0)//判断是否有按下按键的信号
 188   2                      {
 189   3                              delay(10);//延时10ms 消抖
 190   3                              if(k4 == 0)//再次判断按键是否被按下
 191   3                              {
 192   4                                      while(k4 == 0);//直到按键判断松开
 193   4                                      send_4();//松开后执行程序 发送”4“的信号
 194   4                              }
 195   3                      }
 196   2              }
 197   1      }       
 198          
 199          /*------------------------------------------------
 200                              主函数
 201          ------------------------------------------------*/
 202          void main(void)
 203          {
 204   1         while(1)
 205   1         {
 206   2             keyscan();
 207   2         }
 208   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    360    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
